/*! crocos-js - v1.2.0 - 2013-05-30
 * https://github.com/crocos/crocos-js
 * Copyright (c) 2013 ; Licensed  */!function(a){"use strict";var b={locale:"ja_JP"};a.crocos=b,$("html").addClass(window.top===window.self?"self-frame":"in-frame")}("undefined"==typeof exports?this:exports),function(){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d,e,f;if(null==this)throw new TypeError(" this is null or not defined");if(e=Object(this),f=e.length>>>0,"[object Function]"!={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1})}(crocos),function(a){"use strict";a.Deferred=$.Deferred}(crocos),function(a){"use strict";var b={},c=[];b.debug=function(a){c[c.length]=a},b.flush=function(){"undefined"!=typeof console&&c.forEach(function(a){console.log(a)})},a.logger=b}(crocos),function(a){"use strict";var b={};b.nl2br=function(a){return a.replace(/\n/g,"<br />\n")},b.truncate=function(a,b,c){return c=null!=c?c:"..",a.length<=b&&(c=""),a.slice(0,b-c.length)+c},b.redirect=function(a){return null!=window.location?window.location=a:void 0},b.wait=function(a,b){var c=crocos.Deferred(),d=function(){return"FB"==a&&a in b&&"crocos_facebook_initialized"in b&&b.crocos_facebook_initialized?c.resolve(b[a]):a in b&&"FB"!=a?c.resolve(b[a]):setTimeout(function(){return d()},100)};return d(),c.promise()},b.arrayAdd=function(a,b){-1==a.indexOf(b)&&(a[a.length]=b)},b.arrayChunk=function(a,c){return a.length?[a.slice(0,c)].concat(b.arrayChunk(a.slice(c),c)):[]},a.util=a.utils=b,"undefined"!=typeof window&&(a.wait=function(a){return b.wait(a,window)})}(crocos),function(a){"use strict";var b,c={},d={};"undefined"==typeof localStorage?(b.setItem=function(a,b){d[a]=b},b.getItem=function(a){return a in d?d[a]:null},b.clear=function(){d={}}):b=localStorage,c.set=function(a,c){var d=JSON.stringify({created_at:(new Date).getTime(),data:c});try{b.setItem(a,d)}catch(e){b.clear(),b.setItem(a,d)}},c.get=function(a,c){var d=new Date,c=c?c:{},e=b.getItem(a);if(e){if(e=JSON.parse(e),!e||"data"in e)throw"no cache data";if("expire"in c){if(!("created_at"in e))throw"invalid cache data";if(d.getTime()>e.created_at+1e3*c.expire)throw"cache expired"}return e.data}return null},c.has=function(a,b){try{return c.get(a,b),!0}catch(d){return!1}},c.on=function(a,b,d){var e=crocos.Deferred();return setTimeout(function(){c.has(a,d)?e.resolve(c.get(a,d)):b.apply(null,[crocos.Deferred()]).done(function(b){c.set(a,b),e.resolve(b)})},0),e.promise()},c["with"]=c.on,a.cache=c}(crocos),function(a){"use strict";var b,c={},d={};c.ready=function(){var a=crocos.Deferred(),b=!1;return crocos.wait("FB").done(function(){FB.getLoginStatus(function(c){a.resolve(c),b=!0})}),setTimeout(function(){b||a.resolve({status:"unknown"})},7e3),a.promise()},c.api=function(){var a=crocos.Deferred(),b=[];return $.each(arguments,function(a,c){b[b.length]=c}),b[b.length]=function(b){"object"==typeof b&&"error"in b&&b.error?a.reject(b):a.resolve(b)},c.ready().done(function(){FB.api.apply(null,b)}),a.promise()},d.graph=function(){var a=$(".fbx-graph:not(.fbx-processed)"),b={ids:[],fields:[]};c.ready().done(function(){a.each(function(){var a=$(this),c=a.attr("data-fbx-id"),d=a.attr("data-fbx-field");c&&d&&(crocos.util.arrayAdd(b.ids,c),crocos.util.arrayAdd(b.fields,d))}),crocos.util.arrayChunk(b.ids,50).forEach(function(d){d.length&&c.api("/",{ids:d,fields:b.fields,locale:crocos.locale}).done(function(b){a.each(function(){var a=$(this),c=a.attr("data-fbx-id"),d=a.attr("data-fbx-field");c in b&&d in b[c]?(a.text(b[c][d]),a.trigger({type:"fbx:done",data:b[c],response:b})):a.trigger({type:"fbx:fail",response:b}),a.addClass("fbx-processed"),a.trigger({type:"fbx:always",response:b})})})})})},d.likeCount=function(){var a=$(".fbx-like-count:not(.fbx-processed)"),b=[],d={};c.ready().done(function(){a.each(function(){var a=$(this),c=a.attr("data-fbx-url");c&&crocos.util.arrayAdd(b,c)}),crocos.util.arrayChunk(b,30).forEach(function(b){b.length&&c.api("/fql",{q:"SELECT url, like_count FROM link_stat WHERE url IN ('"+b.join("', '")+"')"}).done(function(b){b.data.forEach(function(a){"url"in a&&"like_count"in a&&(d[a.url]=a.like_count)}),a.each(function(){var a=$(this),c=a.attr("data-fbx-url");c in d?(a.text(d[c]),a.trigger({type:"fbx:succeed",count:d[c],response:b})):a.trigger({type:"fbx:fail",response:b}),a.addClass("fbx-processed"),a.trigger({type:"fbx:always",response:b})})})})})},c.fbx=function(){var a=arguments.length>0?arguments[1]:1e4;return a?(d.graph(),d.likeCount(),b=setInterval(function(){d.graph(),d.likeCount()},a),void 0):b&&clearInterval(b)},$(function(){c.fbx(),c.ready().done(function(a){$("html").addClass("fbstatus-"+("status"in a?a.status:"unknown"))})}),a.facebook=c}(crocos),function(a){"use strict";var b={},c=function(){var a=function(a){this.backend=a,this.data={}};return a.prototype.push=function(a){return this.backend.push($.extend({},this.data,a))},a.prototype.setData=function(a){this.data=a},a.prototype.getData=function(){return this.data},a}();b.WebAPI=function(){var a=function(a){var b=$.extend({method:"POST",format:"json"},arguments.length>1?arguments[1]:{});this.endpoint=a,this.method=b.method,this.format=b.format};return a.prototype.push=function(a){return $.ajax({url:this.endpoint,data:a,dataType:this.format,type:this.method})},a}(),a.beacon=c,a.beaconBackend=b}(crocos);