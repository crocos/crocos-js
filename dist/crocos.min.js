/*! crocos-js - v1.1.0 - 2013-01-31
* Copyright (c) 2013 ; Licensed  */
(function(e){"use strict";var t={};e.crocos=t,$(function(){$("html").addClass(window.top===window.self?"self-frame":"in-frame")})})(typeof exports=="undefined"?this:exports),function(e){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r,i,s;if(this==null)throw new TypeError(" this is null or not defined");i=Object(this),s=i.length>>>0;if({}.toString.call(e)!="[object Function]")throw new TypeError(e+" is not a function");t&&(n=t),r=0;while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1})}(crocos),function(e){"use strict";e.Deferred=$.Deferred}(crocos),function(e){"use strict";var t={},n=[];t.debug=function(e){n[n.length]=e},t.flush=function(){typeof console!="undefined"&&n.forEach(function(e){console.log(e)})},e.logger=t}(crocos),function(e){"use strict";var t={};t.nl2br=function(e){return e.replace(/\n/g,"<br />\n")},t.truncate=function(e,t,n){return n=n!=null?n:"..",e.length<=t&&(n=""),e.slice(0,t-n.length)+n},t.redirect=function(e){if(window.location!=null)return window.location=e},t.wait=function(e,t){var n=crocos.Deferred(),r=function(){return e=="FB"&&e in t&&"crocos_facebook_initialized"in t&&t.crocos_facebook_initialized?n.resolve(t[e]):e in t&&e!="FB"?n.resolve(t[e]):setTimeout(function(){return r()},100)};return r(),n.promise()},t.arrayAdd=function(e,t){e.indexOf(t)==-1&&(e[e.length]=t)},t.arrayChunk=function(e,n){return e.length?[e.slice(0,n)].concat(t.arrayChunk(e.slice(n),n)):[]},e.util=e.utils=t,typeof window!="undefined"&&(e.wait=function(e){return t.wait(e,window)})}(crocos),function(e){"use strict";var t={},n,r={};typeof localStorage=="undefined"?(n.setItem=function(e,t){r[e]=t},n.getItem=function(e){return e in r?r[e]:null},n.clear=function(){r={}}):n=localStorage,t.set=function(e,t){var r=JSON.stringify({created_at:(new Date).getTime(),data:t});try{n.setItem(e,r)}catch(i){n.clear(),n.setItem(e,r)}},t.get=function(e,t){var r=new Date,t=t?t:{},i=n.getItem(e);if(i){i=JSON.parse(i);if(!i||"data"in i)throw"no cache data";if("expire"in t){if(!("created_at"in i))throw"invalid cache data";if(r.getTime()>i.created_at+t.expire*1e3)throw"cache expired"}return i.data}return null},t.has=function(e,n){try{return t.get(e,n),!0}catch(r){return!1}},t.on=function(e,n,r){var i=crocos.Deferred();return setTimeout(function(){t.has(e,r)?i.resolve(t.get(e,r)):n.apply(null,[crocos.Deferred()]).done(function(n){t.set(e,n),i.resolve(n)})},0),i.promise()},t["with"]=t.on,e.cache=t}(crocos),function(e){"use strict";var t={},n={},r;t.ready=function(){var e=crocos.Deferred(),t=!1;return crocos.wait("FB").done(function(){FB.getLoginStatus(function(n){e.resolve(n),t=!0})}),setTimeout(function(){t||e.resolve({status:"unknown"})},7e3),e.promise()},t.api=function(){var e=crocos.Deferred(),n=[];return $.each(arguments,function(e,t){n[n.length]=t}),n[n.length]=function(t){typeof t=="object"&&"error"in t&&t.error?e.reject(t):e.resolve(t)},t.ready().done(function(e){FB.api.apply(null,n)}),e.promise()},n.graph=function(){var e=$(".fbx-graph:not(.fbx-processed)"),n={ids:[],fields:[]};t.ready().done(function(r){e.each(function(){var e=$(this),t=e.attr("data-fbx-id"),r=e.attr("data-fbx-field");t&&r&&(crocos.util.arrayAdd(n.ids,t),crocos.util.arrayAdd(n.fields,r))}),crocos.util.arrayChunk(n.ids,50).forEach(function(r){if(!r.length)return;t.api("/",{ids:r,fields:n.fields}).done(function(t){console.log(t),e.each(function(){var e=$(this),n=e.attr("data-fbx-id"),r=e.attr("data-fbx-field");n in t&&r in t[n]?(e.text(t[n][r]),e.trigger({type:"fbx:done",data:t[n],response:t})):e.trigger({type:"fbx:fail",response:t}),e.addClass("fbx-processed"),e.trigger({type:"fbx:always",response:t})})})})})},n.likeCount=function(){var e=$(".fbx-like-count:not(.fbx-processed)"),n=[],r={};t.ready().done(function(i){e.each(function(){var e=$(this),t=e.attr("data-fbx-url");t&&crocos.util.arrayAdd(n,t)}),crocos.util.arrayChunk(n,30).forEach(function(n){if(!n.length)return;t.api("/fql",{q:"SELECT url, like_count FROM link_stat WHERE url IN ('"+n.join("', '")+"')"}).done(function(t){t.data.forEach(function(e){"url"in e&&"like_count"in e&&(r[e.url]=e.like_count)}),e.each(function(){var e=$(this),n=e.attr("data-fbx-url");n in r?(e.text(r[n]),e.trigger({type:"fbx:succeed",count:r[n],response:t})):e.trigger({type:"fbx:fail",response:t}),e.addClass("fbx-processed"),e.trigger({type:"fbx:always",response:t})})})})})},t.fbx=function(){var e=arguments.length>0?arguments[1]:1e4;if(!e)return r&&clearInterval(r);n.graph(),n.likeCount(),r=setInterval(function(){n.graph(),n.likeCount()},e)},$(function(){t.fbx()}),e.facebook=t}(crocos);